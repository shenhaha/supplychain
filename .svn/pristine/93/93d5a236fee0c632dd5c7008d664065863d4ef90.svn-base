$(function () {
    var ctx = $('#ctx').val();
    $('#newuser').click(function () {
        //alert(11);
        var dialog = BootstrapDialog.show({
            type : BootstrapDialog.TYPE_DEFAULT,
            title : "<span style=\"color: #ab8ce4\"><i></i>新增用户</span>",
            closable: false,
            draggable: true,
            cssClass: 'api-blacklist-form-add',
            message:$('<div></div>').load(ctx+'/template/systemmanager/newuser.jsp'),//加载弹出页面
            size : BootstrapDialog.SIZE_NORMAL,//弹出框大小。
            onshown:function () {
            },
            buttons : [{
                id: 'btn-form-submit',
                label: '提交',
                icon: 'fa fa-check-circle',
                cssClass: 'btn-primary',
                action: function(){

                    if ($('#username2').val() == '' || $('#username2').val() == null) {
                        if ($('#la1')) {
                            $('#la1').remove();
                        }
                        $('#username2').after('<label id="la1" class="text-danger">用户名不能为空</label>');
                        return false;
                    }
                    if ($('#password2').val() == '' || $('#password2').val() == null) {
                        if ($('#la2')) {
                            $('#la2').remove();
                        }
                        if ($('#la1')) {
                            $('#la1').remove()
                        }
                        $('#password2').after('<label id="la2" class="text-danger">密码不能为空</label>');
                        return false;
                    }
                    if ($('#repassword2').val() == '' || $('#repassword2').val() == null) {
                        if ($('#la2')) {
                            $('#la2').remove();
                        }
                        if ($('#la1')) {
                            $('#la1').remove()
                        }
                        if ($('#la3')) {
                            $('#la3').remove();
                        }
                        $('#repassword2').after('<label id="la3" class="text-danger">密码不能为空</label>');
                        return false;
                    }
                    if ($('#repassword2').val() != $('#password2').val()) {
                        if ($('#la2')) {
                            $('#la2').remove();
                        }
                        if ($('#la1')) {
                            $('#la1').remove()
                        }
                        if ($('#la3')) {
                            $('#la3').remove();
                        }
                        if ($('#la4')) {
                            $('#la4').remove();
                        }
                        $('#repassword2').after('<label id="la4" class="text-danger">两次密码不相等</label>');
                        return false;}
                    var flag = false;
                    $.get(ctx+'/selectUsersAll', function (data) {
                        $(data.data).each(function () {
                            if (this.username == $('#username2').val()) {
                                $('#userlable').remove();
                                $('#user').append('<lable style="color: red" id="userlable">该用户已存在</lable>')
                                flag = true;
                            }
                        })
                        var users = {
                            'username': $('#username2').val(),
                            'password': $('#password2').val(),
                        };
                        if (flag == false) {
                            $.post(ctx+'/addUsers', users, function (date) {
                                getCode(data);
                            });
                        }
                        return false;
                    })
                }
            },{
                label : '关闭',
                icon: 'fa fa-close',
                action : function(dialogItself) {
                    dialogItself.close();
                }
            } ]
        });
    })
    $('#deleteuser').click(function () {
        var dialog = BootstrapDialog.show({
            type : BootstrapDialog.TYPE_DEFAULT,
            title : "<span style=\"color: #ab8ce4\"><i></i>删除用户</span>",
            closable: false,
            draggable: true,
            cssClass: 'api-blacklist-form-add',
            message:$('<div></div>').load(ctx+'/template/systemmanager/deleteuser.jsp'),//加载弹出页面
            size : BootstrapDialog.SIZE_NORMAL,//弹出框大小。
            onshown:function () {
                $.get(ctx+"/getUsersByStoreID", function (data) {
                    $(data).each(function (index) {
                        //alert(this.username)
                       // $('#userselect').append('<option value="' + this.username + '">' + this.username + '</option>');
                        $('#username3').append('<option value="' + this.username + '">' + this.username + '</option>');
                    })
                })
            },
            buttons : [{
                id: 'btn-form-submit',
                label: '提交',
                icon: 'fa fa-check-circle',
                cssClass: 'btn-primary',
                action: function(){

                    $.post(ctx+'/deleteUser', {'username': $('#username3').val()}, function (data) {
                        getCode(data);
                    });
                }
            },{
                label : '关闭',
                icon: 'fa fa-close',
                action : function(dialogItself) {
                    dialogItself.close();
                }
            } ]
        });
    })
    $('#authmanager').click(function () {
        var dialog = BootstrapDialog.show({
            type : BootstrapDialog.TYPE_DEFAULT,
            title : "<span style=\"color: #ab8ce4\"><i></i>权限管理</span>",
            closable: false,
            draggable: true,
            cssClass: 'api-blacklist-form-add',
            message:$('<div></div>').load(ctx+'/template/systemmanager/authmanager.jsp'),//加载弹出页面
            size : BootstrapDialog.SIZE_WIDE,//弹出框大小。
            onshown:function () {
                $.get(ctx+"/getUsersByStoreID", function (data) {
                    $(data).each(function (index) {
                        //alert(this.username)
                         $('#userselect').append('<option value="' + this.username + '">' + this.username + '</option>');
                        //$('#username3').append('<option value="' + this.username + '">' + this.username + '</option>');
                    })
                })
                var defaultData = [
                    {
                        text: '资料管理',
                        tags: ['4'],
                        nodes: [
                            {
                                text: '总公司基本资料',
                                tags: ['2'],
                            },
                            {
                                text: '下级分公司',
                                tags: ['2'],
                            },
                            {
                                text: '总部加盟',
                                tags: ['2'],
                            },
                            {
                                text: '区域代理',
                                tags: ['2'],
                            },
                            {
                                text: '分公司基本资料',
                                tags: ['2'],
                            },
                            {
                                text: '门店基本资料',
                                tags: ['2'],
                            },
                            {
                                text: '部门基本资料',
                                tags: ['2'],
                            },
                            {
                                text: '员工基本资料',
                                tags: ['0']
                            },
                            {
                                text: '房间类型',
                                tags: ['0']
                            },
                            {
                                text: '房间基本资料',
                                tags: ['0']
                            }, {
                                text: '酒店资料',
                                tags: ['0']
                            }
                        ]
                    },
                    {
                        text: '门店管理',
                        tags: ['4'],
                        nodes: [
                            {
                                text: '排班管理',
                                tags: ['0'],
                            },
                            {
                                text: '排房管理',
                                tags: ['0'],
                                nodes: [
                                    {
                                        text: '查询预览',
                                        tags: ['0']
                                    },
                                    {
                                        text: '排房预览',
                                        tags: ['0']
                                    },
                                    {
                                        text: '入住核实',
                                        tags: ['0']
                                    },
                                    {
                                        text: '换房调整',
                                        tags: ['0']
                                    }
                                ]
                            }, {
                                text: '客诉管理',
                                tags: ['0'],
                                nodes:[
                                    {
                                        text: '客诉记录',
                                        tags: ['0']
                                    },{
                                        text: '客诉统计',
                                        tags: ['0']
                                    }
                                ]
                            },
                            {
                                text: '加值服务内容设定',
                                tags: ['0']
                            },
                            {
                                text: '满意度调查',
                                tags: ['0'],
                            },
                            {
                                text: '退房管理',
                                tags: ['0'],
                                nodes: [
                                    {
                                        text: '退房结算',
                                        tags: ['0']
                                    },
                                    {
                                        text: '购物明细',
                                        tags: ['0']
                                    },
                                    {
                                        text: '优惠券结算',
                                        tags: ['0']
                                    }
                                ]
                            },
                            {
                                text: '会员管理',
                                tags: ['0']
                            }
                        ]
                    },
                    {
                        text: '业务管理',
                        href: '#parent1',
                        tags: ['4'],
                        nodes: [
                            {
                                text: '顾客管理',
                                href: '#child1',
                                tags: ['2'],
                                nodes: [
                                    {
                                        text: '常见问题Q&A',
                                        href: '#grandchild2',
                                        tags: ['0']
                                    },
                                    {
                                        text: '顾客咨询记录',
                                        href: '#grandchild1',
                                        tags: ['0']
                                    },
                                    {
                                        text: '预约客户登记',
                                        href: '#grandchild2',
                                        tags: ['0']
                                    },
                                    {
                                        text: '今日预约客户',
                                        href: '#grandchild2',
                                        tags: ['0']
                                    }
                                ]
                            },
                            {
                                text: '参访人员管理',
                                href: '#child1',
                                tags: ['2'],
                                nodes: [
                                    {
                                        text: '维修人员登记',
                                        href: '#grandchild1',
                                        tags: ['0']
                                    },
                                    {
                                        text: '家属信息登记',
                                        href: '#grandchild2',
                                        tags: ['0']
                                    },
                                    {
                                        text: '预约客户登记',
                                        href: '#grandchild2',
                                        tags: ['0']
                                    }
                                ]
                            },
                            {
                                text: '订单入住管理',
                                href: '#child1',
                                tags: ['2'],
                                nodes: [
                                    {
                                        text: '订单信息输入',
                                        href: '#grandchild1',
                                        tags: ['0']
                                    }, {
                                        text: '入住小贴士',
                                        href: '#grandchild1',
                                        tags: ['0']
                                    }, {
                                        text: '入住提醒',
                                        href: '#grandchild1',
                                        tags: ['0']
                                    },
                                    {
                                        text: '生产联络单',
                                        href: '#grandchild2',
                                        tags: ['0']
                                    },
                                    {
                                        text: '派车单',
                                        href: '#grandchild2',
                                        tags: ['0']
                                    }
                                ]
                            }
                        ]
                    },
                    {
                        text: '服务中心',
                        href: '#parent1',
                        tags: ['4'],
                        nodes: [
                            {
                                text: '预住妈妈信息',
                                href: '#child1',
                                tags: ['2'],
                            },
                            {
                                text: '馆内妈妈信息',
                                href: '#child1',
                                tags: ['2'],
                                nodes: [
                                    {
                                        text: '妈妈信息',
                                        href: '#grandchild1',
                                        tags: ['0']
                                    },
                                    {
                                        text: '小产妈妈信息',
                                        href: '#grandchild1',
                                        tags: ['0']
                                    }
                                ]
                            },
                            {
                                text: '离馆妈妈信息',
                                href: '#child1',
                                tags: ['2'],
                                nodes: [
                                    {
                                        text: '妈妈信息',
                                        href: '#grandchild1',
                                        tags: ['0']
                                    },
                                    {
                                        text: '小产妈妈信息',
                                        href: '#grandchild2',
                                        tags: ['0']
                                    }
                                ]
                            }, {
                                text: '月子餐管理',
                                href: '#child1',
                                tags: ['2'],
                                nodes: [
                                    {
                                        text: '订餐管理',
                                        href: '#grandchild1',
                                        tags: ['0']
                                    },
                                    {
                                        text: '每日统计',
                                        href: '#grandchild2',
                                        tags: ['0']
                                    }
                                ]
                            }, {
                                text: '加值服务统计',
                                href: '#child1',
                                tags: ['2'],
                            }
                        ]
                    },
                    {
                        text: '进销存管理',
                        href: '#parent1',
                        tags: ['4'],
                        nodes: [
                            {
                                text: '库存管理',
                                href: '#child1',
                                nodes:[
                                    {
                                        text: '库存预览',
                                        href: '#child1',
                                        tags: ['2'],
                                    },
                                    {
                                        text: '库存盘点',
                                        href: '#child1',
                                        tags: ['2'],
                                    }
                                ]
                            }, {
                                text: '供应商管理',
                                href: '#child1',
                                tags: ['2'],
                            }, {
                                text: '商品管理',
                                href: '#child1',
                                tags: ['2'],
                                nodes: [
                                    {
                                        text: '总部商品管理',
                                        href: '#grandchild1',
                                        tags: ['0']
                                    },
                                    {
                                        text: '总采购商品管理',
                                        href: '#grandchild2',
                                        tags: ['0']
                                    },
                                    {
                                        text: '自采商品管理',
                                        href: '#grandchild2',
                                        tags: ['0']
                                    }
                                ]
                            }, {
                                text: '订单管理',
                                href: '#child1',
                                tags: ['2'],
                                nodes: [
                                    {
                                        text: '订单起止时间设置',
                                        href: '#grandchild1',
                                        tags: ['0']
                                    },
                                    {
                                        text: '显示所有门店订单',
                                        href: '#grandchild1',
                                        tags: ['0']
                                    },
                                    {
                                        text: '查看汇总订单',
                                        href: '#grandchild2',
                                        tags: ['0']
                                    },
                                    {
                                        text: '门店订单查看',
                                        href: '#grandchild2',
                                        tags: ['0']
                                    },
                                    {
                                        text: '总采订单',
                                        href: '#grandchild2',
                                        tags: ['0']
                                    },
                                    {
                                        text: '自采订单',
                                        href: '#grandchild2',
                                        tags: ['0']
                                    }
                                ]
                            }, {
                                text: '入库管理',
                                href: '#child1',
                                tags: ['2'],
                                nodes: [
                                    {
                                        text: '总部商品入库',
                                        href: '#grandchild1',
                                        tags: ['0']
                                    },
                                    {
                                        text: '总采入库',
                                        href: '#grandchild2',
                                        tags: ['0']
                                    },
                                    {
                                        text: '自采入库',
                                        href: '#grandchild2',
                                        tags: ['0']
                                    }
                                ]
                            }, {
                                text: '出库管理',
                                href: '#child1',
                                tags: ['2'],
                                nodes: [
                                    {
                                        text: '门店出库',
                                        href: '#grandchild1',
                                        tags: ['0']
                                    },
                                    {
                                        text: '领用出库',
                                        href: '#grandchild2',
                                        tags: ['0']
                                    },
                                    {
                                        text: '销售出库',
                                        href: '#grandchild2',
                                        tags: ['0']
                                    }
                                ]
                            }
                        ]
                    },
                    {
                        text: '报表中心',
                        href: '#parent1',
                        nodes:[
                            {
                                text: '各门店排班',
                                href: '#grandchild1',
                                tags: ['0']
                            },
                            {
                                text: '销售报表管理',
                                href: '#grandchild1',
                                nodes:[{
                                    text: '参观人员表',
                                    href: '#grandchild1',
                                    tags: ['0']
                                },{
                                    text: '每月签单数量表',
                                    href: '#grandchild1',
                                    tags: ['0']
                                },{
                                    text: '每日签单数量表',
                                    href: '#grandchild1',
                                    tags: ['0']
                                },{
                                    text: '每月签单金额表',
                                    href: '#grandchild1',
                                    tags: ['0']
                                },{
                                    text: '每月销售总金额表',
                                    href: '#grandchild1',
                                    tags: ['0']
                                }]
                            },{
                                text: '销售报表管理',
                                href: '#grandchild1',
                                tags: ['0']
                            }
                        ]
                    },
                    {
                        text: '系统管理',
                        href: '#parent1',
                        tags: ['4'],
                        nodes: [
                            {
                                text: '用户管理',
                                href: '#child2',
                                tags: ['0'],
                                nodes:[
                                    {
                                        text: '新增用户',
                                        href: '#parent1',
                                    },{
                                        text: '删除用户',
                                        href: '#parent1',
                                    },
                                ]
                            },{
                                text: '权限管理',
                                href: '#grandchild1',
                                nodes:[{
                                    text: '用户权限管理',
                                    href: '#grandchild1',
                                    tags: ['0']
                                },]
                            },
                            {
                                text: '账号管理',
                                href: '#child2',
                                tags: ['0'],
                                nodes:[
                                    {
                                        text: '下级列表',
                                        href: '#parent1',
                                    },{
                                        text: '同级列表',
                                        href: '#parent1',
                                    },
                                ]
                            },
                            {
                                text: '创建下级',
                                href: '#parent1',
                            },{
                                text: '参数管理',
                                href: '#parent1',
                            }
                        ]
                    },
                ];

                var $checkableTree = $('#treeview-checkable').treeview({
                    levels: 1,
                    data: defaultData,
                    showIcon: false,
                    showCheckbox: true,
                    onNodeChecked: function (event, node) {

                        if (node.parentId == undefined) {//没有父节点
                            if (node.nodes == undefined) {//没有子节点

                            } else {//有子节点
                                $(node.nodes).each(function () {
                                    if (this.state.checked == false) {//父节点没有选中
                                        $('#treeview-checkable').treeview('toggleNodeChecked', [this.nodeId, {silent: true}])
                                        if (this.nodes != undefined) {
                                            $(this.nodes).each(function () {
                                                if (this.state.checked == false) {
                                                    $('#treeview-checkable').treeview('toggleNodeChecked', [this.nodeId, {silent: true}])
                                                }
                                            })
                                        }
                                    } else {
                                    }
                                })
                            }
                        } else {//有父节点
                            var parent = $('#treeview-checkable').treeview('getParent', node.nodeId);

                            var grandparent = $('#treeview-checkable').treeview('getParent', parent.nodeId);
                            if (grandparent.nodeId != undefined) {
                                grandparent.state.checked = true;
                            }
                            if (parent.state.checked == false) {//选中时选中也父节点
                                $('#treeview-checkable').treeview('toggleNodeChecked', [parent.nodeId, {silent: true}])
                            }
                            if (node.nodes == undefined) {//没有子节点

                            } else {//有子节点
                                $(node.nodes).each(function () {
                                    $('#treeview-checkable').treeview('toggleNodeChecked', [this.nodeId, {silent: true}])
                                })
                            }
                        }
                        //去除禁用的选中
                        var list = $('#treeview-checkable').treeview('getDisabled');
                        $(list).each(function () {
                            //alert(this);
                            if(this.state.checked == true) {
                                $('#treeview-checkable').treeview('toggleNodeChecked', [this.nodeId, {silent: true}]);
                            }
                        })
                    },
                    onNodeUnchecked: function (event, node) {
                        var brothers = $('#treeview-checkable').treeview('getSiblings', node.nodeId);//获取兄弟节点数组
                        var flag = false;
                        $(brothers).each(function () {
                            if ($(this)[0].state.checked == true) {//其他兄弟有一个选中的，则父节点选中
                                flag = true;
                            }
                        });
                        if (node.nodes != undefined) {
                            $(node.nodes).each(function () {
                                if (this.state.checked == true) {
                                    $('#treeview-checkable').treeview('toggleNodeChecked', [this.nodeId, {silent: true}]);
                                    if (this.nodes != undefined) {
                                        $(this.nodes).each(function () {
                                            if (this.state.checked == true) {
                                                $('#treeview-checkable').treeview('toggleNodeChecked', [this.nodeId, {silent: true}]);
                                            }
                                        })
                                    }
                                }
                            })
                        }
                        var parent = $('#treeview-checkable').treeview('getParent', node.nodeId);//undefined
                        if (parent != 'undefined') {
                            if (flag == false) {
                                if (parent.state != undefined) {
                                    if (parent.state.checked == true) {
                                        $('#treeview-checkable').treeview('toggleNodeChecked', [parent.nodeId, {silent: true}])
                                    }
                                }
                            }
                        }
                        //去除禁用的选中
                        var list = $('#treeview-checkable').treeview('getDisabled');
                        $(list).each(function () {
                            if(this.state.checked == true) {
                                $('#treeview-checkable').treeview('toggleNodeChecked', [this.nodeId, {silent: true}]);
                            }
                        })
                    }
                });

                $('#treeview-checkable').treeview('disableAll');

                $.post(ctx+'/getAuth', function (date) {
                    $(date.data).each(function () {
                        /// alert(this);
                        $('#treeview-checkable').treeview('enableNode', [0, {silent: true}]);
                        $('#treeview-checkable').treeview('enableNode', [parseInt(this), {silent: true}]);
                    })
                })
            },
            buttons : [{
                id: 'btn-form-submit',
                label: '提交',
                icon: 'fa fa-check-circle',
                cssClass: 'btn-primary',
                action: function(){
                    var arr = $('#treeview-checkable').treeview('getChecked');
                    var nodeIds = '';
                    $(arr).each(function (index) {
                        if (index == 0) {
                            nodeIds += this.nodeId;
                        } else {
                            nodeIds += ',' + this.nodeId;
                        }
                    })
                    $.post(ctx+'/addAuths', {'auths': nodeIds, 'username': $('#userselect').val()}, function (data) {
                        getCode(data);
                    });
                }
            },{
                label : '关闭',
                icon: 'fa fa-close',
                action : function(dialogItself) {
                    dialogItself.close();
                }
            } ]
        });
    })
    $('#createlower').click(function () {
        var dialog = BootstrapDialog.show({
            type : BootstrapDialog.TYPE_DEFAULT,
            title : "<span style=\"color: #ab8ce4\"><i></i>创建门店/分公司</span>",
            closable: false,
            draggable: true,
            cssClass: 'login-dialog',
            message:$('<div></div>').load(ctx+'/template/systemmanager/createlower.jsp'),//加载弹出页面
            size : BootstrapDialog.SIZE_WIDE,//弹出框大小。
            onshown:function () {
                $.get(ctx+'/storeFile/selectStoreFilesByHeadquarters', {}, function (data) {
                    $(data).each(function (index) {
                        $('#institution').append('<option value="' + this.id +','+this.name+ '">' + this.name + '</option>');
                    })
                })
                $('#sort').change(function () {
                    if ($(this).val() == '门店') {
                        var headname = '';
                        $('#institution').empty();
                        $.get('${ctx}/storeFile/selectStoreFilesByHeadquarters', {}, function (data) {
                            $(data).each(function (index) {
                                headname = this.name;
                            })
                        })
                        $.get(ctx+'/storeFile/selectStoreFilesByHeadquarters', {}, function (data) {
                            $(data).each(function (index) {
                                if(this.name!=headname){
                                    $('#institution').append('<option value="' + this.id +','+this.name+ '">' + this.name + '</option>');
                                }
                            })
                        })
                        $.get(ctx+'/storeFile/getAllBranch', {}, function (data) {
                            $(data.data).each(function (index) {
                                $('#institution').append('<option value="' + this.id +','+this.name+ '">' + this.name + '</option>');
                            })
                        })
                    }
                    if ($(this).val() == '总公司'||$(this).val() == '区域加盟'||$(this).val() == '总公司加盟') {
                        $('#institution').empty()
                        $.get(ctx+'/storeFile/selectStoreFilesByHeadquarters', {}, function (data) {
                            $(data).each(function (index) {
                                $('#institution').append('<option value="' + this.id +','+this.name+ '">' + this.name + '</option>');
                            })
                        })
                    }
                })
            },
            buttons : [{
                id: 'btn-form-submit',
                label: '提交',
                icon: 'fa fa-check-circle',
                cssClass: 'btn-primary',
                action: function(){
                    var json = {
                        'leader': $('#branchLeader').val(),
                        'username': $("#branchAdmin").val(),
                        'password': $('#Password').val(),
                        'sort':$('#sort').val(),
                        'abbreviation':$('#abbreviation').val(),
                        'name':$('#name').val(),
                        'industryNature':$('#industry_nature').val(),
                        'institutionNum':$('#institution_num').val(),
                        'established':$('#established').val(),
                        'institution':$('#institution').val(),
                        'property':$('#property').val(),
                        'tell':$('#phone').val(),
                        'email':$('#email').val(),
                        'address':$('#address').val(),
                        'zipCode':$('#zip_code').val(),
                        'accountName':$('#account_name').val(),
                        'accountNumber':$('#account_number').val(),
                        'bankname':$('#bankname').val()
                    }
                    var falg = false;//设置不继续执行
                    $.ajax({
                        url:"${ctx}/selectUsersAll",
                        async:false,
                        success:function (data) {
                            $(data.data).each(function () {
                                //alert(this.username);
                                if ($("#branchAdmin").val() == this.username) {
                                    $('#l1').remove();
                                    $("#branchAdmin").after('<lable style="color: red" id="l1">该名称已被使用</lable>');
                                    falg = true;
                                }
                            })
                        }
                    })
                    if(falg == true){
                        return false;
                    }
                    var flag = false;
                    $.ajax({url:ctx+'/selectUser',method:'get',
                        async:false,
                        success:function (data) {
                                $(data.data).each(function () {
                                    if (this.username == $("#branchAdmin").val()) {
                                        $('#userlable').remove();
                                        $('#branchAdmin').append('<lable style="color: red" id="userlable">该用户已存在</lable>')
                                        flag = true;
                                    }
                                })
                        }})
                    if(flag==true){
                        return false;
                    }
                    $("#myform").bootstrapValidator({
                        live: 'disabled',//验证时机，enabled是内容有变化就验证（默认），disabled和submitted是提交再验证
                        excluded: [':disabled', ':hidden', ':not(:visible)'],//排除无需验证的控件，比如被禁用的或者被隐藏的
                        submitButtons: '#btn-test',//指定提交按钮，如果验证失败则变成disabled，但我没试成功，反而加了这句话非submit按钮也会提交到action指定页面
                        message: '通用的验证失败消息',//好像从来没出现过
                        feedbackIcons: {//根据验证结果显示的各种图标
                            valid: 'glyphicon glyphicon-ok',
                            invalid: 'glyphicon glyphicon-remove',
                            validating: 'glyphicon glyphicon-refresh'
                        },
                        fields: {
                            branchLeader: {
                                validators: {
                                    notEmpty: {
                                        message: '负责人不能为空'
                                    },
                                }
                            },
                            branchAdmin:{
                                validators: {
                                    notEmpty: {
                                        message: '管理员账号不能为空！'
                                    },
                                    regexp: {/* 只需加此键值对，包含正则表达式，和提示 */
                                        //regexp: /^[a-zA-Z0-9_\.]+$/, //只能是数字,字母和_.
                                        regexp: /^[0-9a-zA-Z]*$/g, //只能是数字和字母
                                        message: '只能是数字和字母.'
                                    },
                                    stringLength: {/*长度提示*/
                                        min: 6,
                                        max: 18,
                                        message: '管理员账号长度必须在6到18之间'
                                    }
                                }
                            },Password: {
                                validators: {
                                    notEmpty: {
                                        message: '管理员密码不能为空！'
                                    },
                                    regexp: {/* 只需加此键值对，包含正则表达式，和提示 */
                                        //regexp: /^[a-zA-Z0-9_\.]+$/, //只能是数字,字母和_.
                                        regexp: /^[0-9a-zA-Z]*$/g, //只能是数字和字母
                                        message: '只能是数字和字母.'
                                    },
                                    stringLength: {/*长度提示*/
                                        min: 6,
                                        max: 18,
                                        message: '管理员密码长度必须在6到18之间'
                                    }
                                }
                            },abbreviation: {
                                validators: {
                                    notEmpty: {
                                        message: '机构简称不能为空！'
                                    },
                                }
                            },name: {
                                validators: {
                                    notEmpty: {
                                        message: '企业名不能为空！'
                                    },
                                }
                            },industry_nature: {
                                validators: {
                                    notEmpty: {
                                        message: '行业性质不能为空！'
                                    },
                                }
                            },tell: {
                                validators: {
                                    notEmpty: {
                                        message: '电话不能为空！'
                                    },
                                }
                            },email: {
                                validators: {
                                    notEmpty: {
                                        message: '邮箱不能为空！'
                                    },
                                    emailAddress: {
                                        message: '邮箱地址格式有误'
                                    }
                                }
                            },address: {
                                validators: {
                                    notEmpty: {
                                        message: '地址不能为空！'
                                    },
                                }
                            },zip_code: {
                                validators: {
                                    notEmpty: {
                                        message: '邮编不能为空！'
                                    },
                                }
                            },account_name: {
                                validators: {
                                    notEmpty: {
                                        message: '银行开户名不能为空！'
                                    },
                                }
                            },account_number: {
                                validators: {
                                    notEmpty: {
                                        message: '银行账号不能为空！'
                                    }
                                }
                            },
                            phone: {
                                validators: {
                                    notEmpty: {
                                        message: '电话不能为空！'
                                    },
                                    regexp: {
                                        regexp: /^[1][3,4,5,7,8][0-9]{9}$/,
                                        message: '手机格式不正确'
                                    }
                                }
                            },
                            bankname: {
                                validators: {
                                    notEmpty: {
                                        message: '银行开户行不能为空！'
                                    },
                                }
                            },
                            property: {
                                validators: {
                                    notEmpty: {
                                        message: '公司性质不能为空！'
                                    },
                                }
                            },
                            institution_num: {
                                validators: {
                                    notEmpty: {
                                        message: '机构编号不能为空！'
                                    },
                                }
                            },
                        }
                    });
                    var bootstrapValidator = $("#myform").data('bootstrapValidator');
                    bootstrapValidator.validate();
                    if(bootstrapValidator.isValid()){
                        $.post(ctx+'/addBranch', json, function (data) {
                            getCode(data);
                        })
                    }
                }
            },{
                label : '关闭',
                icon: 'fa fa-close',
                action : function(dialogItself) {
                    dialogItself.close();
                }
            } ]
        });
    })
})