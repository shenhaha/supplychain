<%@ page contentType="text/html;charset=UTF-8" language="java" %>
<%@ taglib prefix="c" uri="http://java.sun.com/jsp/jstl/core" %>
<c:set var="ctx" value="${pageContext.request.contextPath}"/>
<c:set var="motherid" value="${pageContext.request.getParameter('motherid')}" />
<html>
<head>
    <title>出馆身体评估表</title>
</head>
<body>
<!--Main Content-->
<div class="page-wrapper">
    <div class="container-fluid">
        <!-- Row -->
        <div class="row">
            <div class="col-sm-12">
                <ul id="myTab" class="nav nav-tabs" style="margin-top: 10px">
                    <li id="babybasic"><a  href="${ctx}/servicecenter/babybasic?motherid=${motherid}">宝宝基本信息</a></li>
                    <li id="babyEvaluate"><a  href="${ctx}/servicecenter/babyEvaluate?motherid=${motherid}">宝宝入住评估</a></li>
                    <li  id="showBabyNursing"><a href="${ctx}/babynursing/showBabyNursing?motherid=${motherid}">宝宝护理记录</a></li>
                    <li id="showGrowth"><a  href="${ctx}/growth/showGrowth?motherid=${motherid}">宝宝成长记录</a></li>
                    <li id="showNeonatalrounds"><a  href="${ctx}/neonatalrounds/showNeonatalrounds?motherid=${motherid}">儿科医生查房</a></li>
                <%--    <li id="showSwimming"><a  href="${ctx}/swimming/showSwimming?motherid=${motherid}">宝宝游泳</a></li>
                    <li id="babywash" ><a href="${ctx}/swimming/babywash?motherid=${motherid}">洗澡记录</a></li>
                    <li id="showPavilionassessment"><a href="${ctx}/pavilionassessment/showPavilionassessment?motherid=${motherid}">出馆身体评估</a></li>--%>
                    <li id="showPavilioneducation"><a href="${ctx}/pavilioneducation/showPavilioneducation?motherid=${motherid}">出馆卫教</a></li>
                </ul>
                    <!--出馆卫教-->
                    <div id="repairdiv">
                        <div class="panel-body" >
                            <div class="table-responsive">
                                        <table id="pavilionhealth" class="table" data-paging="true" data-filtering="true" data-sorting="true" style="width:200%">
                                        </table>
                            </div>
                        </div>
                    </div>
                    <!--出馆卫教-->
            </div>
        </div>
        <!-- /Row -->
    </div>
</div>
<script>
    $(function () {
        $('#showPavilionassessment').addClass("active");
        var ur=location.href;
        var type=ur.split('/')[4].split("?")[0];
        switch (type){
            case 'babybasic':
                $('#babybasic').addClass("active");
                break;
            case 'babyEvaluate':
                $('#babyEvaluate').addClass("active");
                break;
            case 'showBabyNursing':
                $('#showBabyNursing').addClass("active");
                break;
            case 'showGrowth':
                $('#showGrowth').addClass("active");
                break;
            case 'showNeonatalrounds':
                $('#showNeonatalrounds').addClass("active");
                break;
            case 'babywash':
                $('#babywash').addClass("active");
                break;
            case 'showPavilionassessment':
                $('#showPavilionassessment').addClass("active");
                break;
            case 'showPavilioneducation':
                $('#showPavilioneducation').addClass("active");
                break;
        }
        var pavilioneducationTitle = [
            {
                "name": "id",
                "title": "ID",
                "breakpoints": "xs sm",visible:false
            },
            {"name": "babyname", "title": "宝宝姓名"},
            {"name": "paviliondate", "title": "出馆时间"},
            {"name": "status", "title": "进食情形"},
            {"name": "scalp", "title": "头部"},
            {"name": "eye", "title": "眼部"},
            {"name": "ear", "title": "耳朵"},
            {"name": "oral", "title": "口腔"},
            {"name": "nose", "title": "鼻子"},
            {"name": "cheek", "title": "面颊"},
            {"name": "detail", "title": "查看详情"},
            {"name": "chest", "title": "胸部",visible:false},
            {"name": "abdomen", "title": "腹部",visible:false},
            {"name": "umbilicalcord", "title": "脐带",visible:false},
            {"name": "genital", "title": "生殖器",visible:false},
            {"name": "limbs", "title": "四肢",visible:false},
            {"name": "informobjece", "title": "告知对象",visible:false},
            {"name": "assessmenttime", "title": "评估时间",visible:false},
        ];
        function detail(values) {
            var dialog = BootstrapDialog.show({
                type : BootstrapDialog.TYPE_DEFAULT,
                title : "<span style=\"color: #ab8ce4\">修改一条数据</span>",
                closable: false,
                draggable: true,
                cssClass: 'api-blacklist-form-add',
                message:$('<div></div>').load('${ctx}/template/servicecenter/pavilionhealth.jsp'),//加载弹出页面
                size : BootstrapDialog.SIZE_WIDE,//弹出框大小。
                //数据回显
                onshown:function(dialogRef){
                    $('#id').val(values.id);
                    $('#mother').val(values.mother);
                    $('#father').val(values.father);
                    $('#paviliondate').val(values.paviliondate);
                    $('#status').val(values.status);
                    $('#scalp').val(values.scalp);
                    $('#eye').val(values.eye);
                    $('#ear').val(values.ear);
                    $('#oral').val(values.oral);
                    $('#nose').val(values.nose);
                    $('#cheek').val(values.cheek);
                    $('#chest').val(values.chest);
                    $('#abdomen').val(values.abdomen);
                    $('#umbilicalcord').val(values.umbilicalcord);
                    $('#genital').val(values.genital);
                    $('#limbs').val(values.limbs);
                    $('#informobjece').val(values.informobjece);
                    $('#assessmenttime').val(values.assessmenttime);
                    $('#babyname').append("<option>"+values.babyname+"</option>").attr("disabled","disabled");
                    $('#myform').find("select,input").attr("disabled","disabled");
                },
                buttons:[{
                    label : '关闭',
                    icon: 'fa fa-close',
                    action : function(dialogItself) {
                        dialogItself.close();
                    }
                }],
            });
        }
        window.detail = detail;
        //启动footable
        var ft = FooTable.init('#pavilionhealth',{
            "columns": pavilioneducationTitle,
            "rows": $.get("${ctx}/pavilionassessment/getPavilionByMotherId?motherid="+'${motherid}',function (data) {
                $(data).each(function () {
                    this.detail = "<button class='btn btn-primary btn-sm' onclick='detail("+JSON.stringify(this)+")'>查看详情</button>";
                })
            }),
            //功能操作
            editing: {
                enabled: true,
                addRow: function(){
                    //新增模态框
                    var $that = $(this);
                    var dialog =  BootstrapDialog.show({
                        type : BootstrapDialog.TYPE_DEFAULT,
                        title : "<span style=\"color: #ab8ce4\">新增一条数据</span>",
                        closable: false,
                        draggable: true,
                        cssClass: 'api-blacklist-form-add',
                        message:$('<div></div>').load('${ctx}/template/servicecenter/pavilionhealth.jsp'),//加载弹出页面
                        size : BootstrapDialog.SIZE_WIDE,//弹出框大小。
                        onhide:function(){
                            $that.removeAttr("disabled");
                        },onshown:function () {
                            $.get("${ctx}/customerBasic/getBabyBasics?motherId="+'<%=request.getParameter("motherid")%>',function (data) {
                                $(data).each(function () {
                                    $("#babyname").append("<option value='"+this.name+"'>"+this.name+"</option>")
                                })
                            })
                        },
                        buttons:[{
                            id: 'btn-form-submit',
                            label: '提交',
                            icon: 'fa fa-check-circle',
                            cssClass: 'btn-primary',
                            action:function(){//点击事件
                                var json = {
                                    'id':$('#id').val(),
                                    'mother':$('#mother').val(),
                                    'father':$('#father').val(),
                                    'status':$('#status').val(),
                                    'condition':$('#condition').val(),
                                    'scalp':$('#scalp').val(),
                                    'eye':$('#eye').val(),
                                    'ear':$('#ear').val(),
                                    'oral':$('#oral').val(),
                                    'nose':$('#nose').val(),
                                    'cheek':$('#cheek').val(),
                                    'chest':$('#chest').val(),
                                    'abdomen':$('#abdomen').val(),
                                    'umbilicalcord':$('#umbilicalcord').val(),
                                    'genital':$('#genital').val(),
                                    'limbs':$('#limbs').val(),
                                    'informobjece':$('#informobjece').val(),
                                    'assessmenttime':$('#assessmenttime').val(),
                                    'babyname':$('#babyname').val(),
                                    'paviliondate':$('#paviliondate').val(),
                                    'customerId':'${motherid}',
                                    'storeId':'<%=session.getAttribute("storeId")%>'
                                };
                                $("#myform").bootstrapValidator({
                                    live: 'disabled',//验证时机，enabled是内容有变化就验证（默认），disabled和submitted是提交再验证
                                    excluded: [':disabled', ':hidden', ':not(:visible)'],//排除无需验证的控件，比如被禁用的或者被隐藏的
                                    submitButtons: '#btn-test',//指定提交按钮，如果验证失败则变成disabled，但我没试成功，反而加了这句话非submit按钮也会提交到action指定页面
                                    message: '通用的验证失败消息',//好像从来没出现过
                                    feedbackIcons: {//根据验证结果显示的各种图标
                                        valid: 'glyphicon glyphicon-ok',
                                        invalid: 'glyphicon glyphicon-remove',
                                        validating: 'glyphicon glyphicon-refresh'
                                    },
                                    fields:{ //需要验证的字段
                                        /*mother: {
                                            validators: {
                                                notEmpty: {
                                                    message: '宝妈不能为空'
                                                },
                                            }
                                        },

                                        babyname: {
                                            validators: {
                                                notEmpty: {
                                                    message: '宝宝姓名不能为空'
                                                },
                                            }
                                        },

                                        father: {
                                            validators: {
                                                notEmpty: {
                                                    message: '宝爸不能为空'
                                                },
                                            }
                                        },*/

                                        status: {
                                            validators: {
                                                notEmpty: {
                                                    message: '进食情形不能为空'
                                                },
                                            }
                                        },

                                        scalp: {
                                            validators: {
                                                notEmpty: {
                                                    message: '头部不能为空'
                                                },
                                            }
                                        },

                                        eye: {
                                            validators: {
                                                notEmpty: {
                                                    message: '眼部不能为空'
                                                },
                                            }
                                        },

                                        ear: {
                                            validators: {
                                                notEmpty: {
                                                    message: '耳朵不能为空'
                                                },
                                            }
                                        },


                                        oral: {
                                            validators: {
                                                notEmpty: {
                                                    message: '口腔不能为空'
                                                },
                                            }
                                        },


                                        nose: {
                                            validators: {
                                                notEmpty: {
                                                    message: '鼻子不能为空'
                                                },
                                            }
                                        },

                                        cheek: {
                                            validators: {
                                                notEmpty: {
                                                    message: '面颊不能为空'
                                                },
                                            }
                                        },

                                        chest: {
                                            validators: {
                                                notEmpty: {
                                                    message: '胸部不能为空'
                                                },
                                            }
                                        },

                                        abdomen: {
                                            validators: {
                                                notEmpty: {
                                                    message: '腹部不能为空'
                                                },
                                            }
                                        },

                                        umbilicalcord: {
                                            validators: {
                                                notEmpty: {
                                                    message: '脐带不能为空'
                                                },
                                            }
                                        },

                                        genital: {
                                            validators: {
                                                notEmpty: {
                                                    message: '生殖器不能为空'
                                                },
                                            }
                                        },

                                        limbs: {
                                            validators: {
                                                notEmpty: {
                                                    message: '四肢不能为空'
                                                },
                                            }
                                        },
                                        informobjece: {
                                            validators: {
                                                notEmpty: {
                                                    message: '告知对象不能为空'
                                                },
                                            }
                                        },
                                    }
                                });
                                var bootstrapValidator = $("#myform").data('bootstrapValidator');
                                bootstrapValidator.validate();
                                if(bootstrapValidator.isValid()) { //新增
                                    $.post("${ctx}/pavilionassessment/addPavilionAssessment",json).done(function(data){getCode(data)}).fail(function(data){getCode(data)});
                                }
                            }
                        },{
                            label:'关闭',
                            icon:'fa fa-close',
                            action:function(dialogItself) {
                                dialogItself.close();
                            }
                        }]
                    });
                },
                //这里是修改时绑定数据
                editRow: function(row){
                    var values = row.val();
                    var $that = $(this);
                    //失效
                    $that.attr("disabled","disabled");
                    // 调用add方法
                    var dialog = BootstrapDialog.show({
                        type : BootstrapDialog.TYPE_DEFAULT,
                        title : "<span style=\"color: #ab8ce4\">修改一条数据</span>",
                        closable: false,
                        draggable: true,
                        cssClass: 'api-blacklist-form-add',
                        message:$('<div></div>').load('${ctx}/template/servicecenter/pavilionhealth.jsp'),//加载弹出页面
                        size : BootstrapDialog.SIZE_WIDE,//弹出框大小。
                        //数据回显
                        onshown:function(dialogRef){
                            $('#id').val(values.id);
                            $('#mother').val(values.mother);
                            $('#father').val(values.father);
                            $('#paviliondate').val(values.paviliondate);
                            $('#status').val(values.status);
                            $('#scalp').val(values.scalp);
                            $('#eye').val(values.eye);
                            $('#ear').val(values.ear);
                            $('#oral').val(values.oral);
                            $('#nose').val(values.nose);
                            $('#cheek').val(values.cheek);
                            $('#chest').val(values.chest);
                            $('#abdomen').val(values.abdomen);
                            $('#umbilicalcord').val(values.umbilicalcord);
                            $('#genital').val(values.genital);
                            $('#limbs').val(values.limbs);
                            $('#informobjece').val(values.informobjece);
                            $('#assessmenttime').val(values.assessmenttime);
                            $('#babyname').append("<option>"+values.babyname+"</option>").attr("disabled","disabled");
                        },
                        buttons:[{
                            id: 'btn-form-submit',
                            label: '提交',
                            icon: 'fa fa-check-circle',
                            cssClass: 'btn-primary',
                            action:function(){
                                var json = {
                                    'id':$('#id').val(),
                                    'mother':$('#mother').val(),
                                    'father':$('#father').val(),
                                    'status':$('#status').val(),
                                    'condition':$('#condition').val(),
                                    'scalp':$('#scalp').val(),
                                    'eye':$('#eye').val(),
                                    'ear':$('#ear').val(),
                                    'oral':$('#oral').val(),
                                    'nose':$('#nose').val(),
                                    'cheek':$('#cheek').val(),
                                    'chest':$('#chest').val(),
                                    'abdomen':$('#abdomen').val(),
                                    'umbilicalcord':$('#umbilicalcord').val(),
                                    'genital':$('#genital').val(),
                                    'limbs':$('#limbs').val(),
                                    'informobjece':$('#informobjece').val(),
                                    'assessmenttime':$('#assessmenttime').val(),
                                    'babyname':$('#babyname').val(),
                                    'customerId':'${motherid}',
                                    'storeId':'<%=session.getAttribute("storeId")%>'
                                };

                                $("#myform").bootstrapValidator({
                                    live: 'disabled',//验证时机，enabled是内容有变化就验证（默认），disabled和submitted是提交再验证
                                    excluded: [':disabled', ':hidden', ':not(:visible)'],//排除无需验证的控件，比如被禁用的或者被隐藏的
                                    submitButtons: '#btn-test',//指定提交按钮，如果验证失败则变成disabled，但我没试成功，反而加了这句话非submit按钮也会提交到action指定页面
                                    message: '通用的验证失败消息',//好像从来没出现过
                                    feedbackIcons: {//根据验证结果显示的各种图标
                                        valid: 'glyphicon glyphicon-ok',
                                        invalid: 'glyphicon glyphicon-remove',
                                        validating: 'glyphicon glyphicon-refresh'
                                    },
                                    fields: {
                                        /*mother: {
                                            validators: {
                                                notEmpty: {
                                                    message: '宝妈不能为空'
                                                },
                                            }
                                        },

                                        babyname: {
                                            validators: {
                                                notEmpty: {
                                                    message: '宝宝姓名不能为空'
                                                },
                                            }
                                        },

                                        father: {
                                            validators: {
                                                notEmpty: {
                                                    message: '宝爸不能为空'
                                                },
                                            }
                                        },*/

                                        status: {
                                            validators: {
                                                notEmpty: {
                                                    message: '进食情形不能为空'
                                                },
                                            }
                                        },

                                        scalp: {
                                            validators: {
                                                notEmpty: {
                                                    message: '头部不能为空'
                                                },
                                            }
                                        },

                                        eye: {
                                            validators: {
                                                notEmpty: {
                                                    message: '眼部不能为空'
                                                },
                                            }
                                        },

                                        ear: {
                                            validators: {
                                                notEmpty: {
                                                    message: '耳朵不能为空'
                                                },
                                            }
                                        },


                                        oral: {
                                            validators: {
                                                notEmpty: {
                                                    message: '口腔不能为空'
                                                },
                                            }
                                        },


                                        nose: {
                                            validators: {
                                                notEmpty: {
                                                    message: '鼻子不能为空'
                                                },
                                            }
                                        },

                                        cheek: {
                                            validators: {
                                                notEmpty: {
                                                    message: '面颊不能为空'
                                                },
                                            }
                                        },

                                        chest: {
                                            validators: {
                                                notEmpty: {
                                                    message: '胸部不能为空'
                                                },
                                            }
                                        },

                                        abdomen: {
                                            validators: {
                                                notEmpty: {
                                                    message: '腹部不能为空'
                                                },
                                            }
                                        },

                                        umbilicalcord: {
                                            validators: {
                                                notEmpty: {
                                                    message: '脐带不能为空'
                                                },
                                            }
                                        },

                                        genital: {
                                            validators: {
                                                notEmpty: {
                                                    message: '生殖器不能为空'
                                                },
                                            }
                                        },

                                        limbs: {
                                            validators: {
                                                notEmpty: {
                                                    message: '四肢不能为空'
                                                },
                                            }
                                        },
                                        informobjece: {
                                            validators: {
                                                notEmpty: {
                                                    message: '告知对象不能为空'
                                                },
                                            }
                                        },
                                    },
                                });

                                var bootstrapValidator = $("#myform").data('bootstrapValidator');
                                bootstrapValidator.validate();
                                if(bootstrapValidator.isValid()){
                                    $.post("${ctx}/pavilionassessment/updatePavilionAssessment",json).
                                    done(function(data){getCode(data)}).
                                    fail(function(data){getCode(data)});
                                    //修改一条记录  url  服务器地址
                                }
                            }
                        },{
                            label : '关闭',
                            icon: 'fa fa-close',
                            action : function(dialogItself) {
                                dialogItself.close();
                            }
                        }],
                    });
                },
                //删除操作
                deleteRow: function(row){
                    myConfirm("${ctx}/pavilionassessment/delPavilionAssessment",row);
                }
            }
        });
        uid = 10;
    });
</script>
</body>
</html>
