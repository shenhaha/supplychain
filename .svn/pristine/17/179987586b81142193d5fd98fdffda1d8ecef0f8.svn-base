<%@ page contentType="text/html;charset=UTF-8" language="java" %>
<%@ taglib prefix="c" uri="http://java.sun.com/jsp/jstl/core"%>
<c:set var="ctx" value="${pageContext.request.contextPath}" />
<html>
<head>
    <title>会议记录信息</title>
    <style type="text/css">
        html, body {width: 100%; height: 100%; overflow: hidden; font: 22px/1.6 sans-serif; }
        .column { display: inline-block; width: 100%; height: 60%; margin: 0 0;}
    </style>
</head>
<body>
<input style="display:none" type="hidden" id="storeId" value="${storeId}">
<div class="container-fluid">
    <!-- Row -->
    <div class="row">
        <div class="col-sm-12">
                <div class="panel-heading">
                    <div class="pull-left">
                        <ol class="breadcrumb">
                            <li><a href="${ctx}/index">首页</a></li>
                            <li class="active">门店人员会议管理</li>
                        </ol>
                    </div>
                    <div class="clearfix" ></div>
                </div>
                <!--门店人员会议开始-->
                <div id="repairdiv">
                    <div class="panel-body" >
                        <div class="table-responsive">
                            <div id="os1" class="optiscroll column mid-80">
                                <p style="width: 150%">
                                <table id="meetingrecordList" class="table" data-paging="true" data-filtering="true" data-sorting="true" style="width:200%">
                                </table>
                                </p>
                            </div>
                        </div>
                    </div>
                </div>
                <!--门店人员会议结束-->
         </div>
    </div>
    <!-- /Row -->
</div>
<script >
    $(function () {
        var storeValue = $("#storeId").val();
        var meetingrecordTitle = [
            {"name": "id", "visible": false},
            {"name": "storeFileId", "visible": false},
            {"name": "storeFileName", "title": "店铺名称"},
            {"name": "department", "title": "部门"},
            {"name": "meetingtime", "title": "会议时间"},
            {"name": "place", "title": "地点"},
            {"name": "attendees", "title": "出席人员"},
            {"name": "absencepersonnel", "title": "缺席人员"},
            {"name": "host", "title": "主持人"},
            {"name": "recorder", "title": "记录人"},
            {"name": "meetingcontent", "title": "会议内容"},
            {"name": "note", "title": "备注"},
            {"name": "signature", "title": "阅后签名"},
            {"name": "endtime", "title": "会议结束时间"},
            {"name": "nexttime", "title": "下期会议时间"}
        ];
        //启动模态框
        //启动footable
        var ft = FooTable.init('#meetingrecordList', {
            "columns": meetingrecordTitle,
            "rows": $.get("${ctx}/meetingrecord/selectMeetingrecordAllBystoreId?storeId="+storeValue), //查询服务器路径
            //功能操作
            editing: {
                enabled: true,
                addRow: function () {
                    //新增模态框
                    var dialog = BootstrapDialog.show({
                        type: BootstrapDialog.TYPE_DEFAULT,
                        title: "<span style=\"color: #ab8ce4\"><i></i>新增一条数据</span>",
                        closable: false,
                        draggable: true,
                        cssClass: 'api-blacklist-form-add',
                        message: $('<div></div>').load('${ctx}/template/storemanager/meetingrecordList.jsp'),//加载弹出页面
                        size: BootstrapDialog.SIZE_WIDE,//弹出框大小。
                        buttons: [{
                            id: 'btn-form-submit',
                            label: '提交',
                            icon: 'fa fa-check-circle',
                            cssClass: 'btn-primary',
                            action: function () {
                                var json = {
                                    storeFileId : storeValue,
                                    department: $('#department').val(),
                                    meetingtime: $('#meetingtime').val(),
                                    place: $('#place').val(),
                                    attendees: $('#attendees').val(),
                                    absencepersonnel: $('#absencepersonnel').val(),
                                    host: $('#host').val(),
                                    recorder: $('#recorder').val(),
                                    meetingcontent: $('#meetingcontent').val(),
                                    note: $('#note').val(),
                                    signature: $('#signature').val(),
                                    endtime: $('#endtime').val(),
                                    nexttime: $('#nexttime').val()
                                };
                                $("#myform").bootstrapValidator({
                                    live: 'disabled',//验证时机，enabled是内容有变化就验证（默认），disabled和submitted是提交再验证
                                    excluded: [':disabled', ':hidden', ':not(:visible)'],//排除无需验证的控件，比如被禁用的或者被隐藏的
                                    submitButtons: '#btn-test',//指定提交按钮，如果验证失败则变成disabled，但我没试成功，反而加了这句话非submit按钮也会提交到action指定页面
                                    message: '通用的验证失败消息',//好像从来没出现过
                                    feedbackIcons: {//根据验证结果显示的各种图标
                                        valid: 'glyphicon glyphicon-ok',
                                        invalid: 'glyphicon glyphicon-remove',
                                        validating: 'glyphicon glyphicon-refresh'
                                    },
                                    fields: {
                                        storeFileId: {
                                            validators: {
                                                notEmpty: {
                                                    message: '店铺名称'
                                                },
                                            }
                                        },
                                        department: {
                                            validators: {
                                                notEmpty: {
                                                    message: '所属部门不能为空!'
                                                },
                                            }
                                        },
                                        meetingtime: {
                                            validators: {
                                                notEmpty: {
                                                    message: '会议时间！'
                                                },
                                            }
                                        },
                                        place: {
                                            validators: {
                                                notEmpty: {
                                                    message: '会议地点不能为空！'
                                                },
                                            }
                                        },
                                        attendees: {
                                            validators: {
                                                notEmpty: {
                                                    message: '出席人员不能为空！'
                                                },
                                            }
                                        },
                                        host: {
                                            validators: {
                                                notEmpty: {
                                                    message: '主持人不能为空！'
                                                },
                                            }
                                        },
                                        meetingcontent: {
                                            validators: {
                                                notEmpty: {
                                                    message: '会议内容不能为空！'
                                                },
                                            }
                                        },
                                        endtime: {
                                            validators: {
                                                notEmpty: {
                                                    message: '结束时间不能为空！'
                                                },
                                            }
                                        },
                                    }
                                });
                                var bootstrapValidator = $("#myform").data('bootstrapValidator');
                                bootstrapValidator.validate();
                                if (bootstrapValidator.isValid()) {
                                    //新增一条记录   url服务器路径
                                    $.post("${ctx}/meetingrecord/addMeetingrecord", json).done(function (data) {
                                        getCode(data)
                                    }).fail(function (data) {
                                        getCode(data)
                                    });
                                }
                            }
                        }, {
                            label: '关闭',
                            icon: 'fa fa-close',
                            action: function (dialogItself) {
                                dialogItself.close();
                            }
                        }]
                    });
                },
                //这里是修改时绑定数据
                editRow: function (row) {
                    var values = row.val();
                    var dialog = BootstrapDialog.show({
                        type: BootstrapDialog.TYPE_DEFAULT,
                        title: "<span style=\"color: #ab8ce4\"><i></i>修改一条数据</span>",
                        closable: false,
                        draggable: true,
                        cssClass: 'api-blacklist-form-add',
                        message: $('<div></div>').load('${ctx}/template/storemanager/meetingrecordList.jsp'),//加载弹出页面
                        size: BootstrapDialog.SIZE_WIDE,//弹出框大小。
                        onshown: function () {
                            $('#id').val(values.id);
                            $('#storeFileId').val(values.storeFileId);
                            $('#department').val(values.department);
                            $('#meetingtime').val(values.meetingtime);
                            $('#place').val(values.place);
                            $('#attendees').val(values.attendees);
                            $('#absencepersonnel').val(values.absencepersonnel);
                            $('#host').val(values.host);
                            $('#recorder').val(values.recorder);
                            $('#meetingcontent').val(values.meetingcontent);
                            $('#note').val(values.note);
                            $('#signature').val(values.signature);
                            $('#endtime').val(values.endtime);
                            $('#nexttime').val(values.nexttime);
                        },
                        buttons: [{
                            id: 'btn-form-submit',
                            label: '提交',
                            icon: 'fa fa-check-circle',
                            cssClass: 'btn-primary',
                            action: function () {
                                var json = {
                                    id: $('#id').val(),
                                    storeFileId: storeValue,
                                    department: $('#department').val(),
                                    meetingtime: $('#meetingtime').val(),
                                    place: $('#place').val(),
                                    attendees: $('#attendees').val(),
                                    absencepersonnel: $('#absencepersonnel').val(),
                                    host: $('#host').val(),
                                    recorder: $('#recorder').val(),
                                    meetingcontent: $('#meetingcontent').val(),
                                    note: $('#note').val(),
                                    signature: $('#signature').val(),
                                    endtime: $('#endtime').val(),
                                    nexttime: $('#nexttime').val()
                                };
                                $("#myform").bootstrapValidator({
                                    live: 'disabled',//验证时机，enabled是内容有变化就验证（默认），disabled和submitted是提交再验证
                                    excluded: [':disabled', ':hidden', ':not(:visible)'],//排除无需验证的控件，比如被禁用的或者被隐藏的
                                    submitButtons: '#btn-test',//指定提交按钮，如果验证失败则变成disabled，但我没试成功，反而加了这句话非submit按钮也会提交到action指定页面
                                    message: '通用的验证失败消息',//好像从来没出现过
                                    feedbackIcons: {//根据验证结果显示的各种图标
                                        valid: 'glyphicon glyphicon-ok',
                                        invalid: 'glyphicon glyphicon-remove',
                                        validating: 'glyphicon glyphicon-refresh'
                                    },
                                    fields: {
                                        storeFileId: {
                                            validators: {
                                                notEmpty: {
                                                    message: '店铺名称'
                                                },
                                            }
                                        },
                                        department: {
                                            validators: {
                                                notEmpty: {
                                                    message: '所属部门不能为空!'
                                                },
                                            }
                                        },
                                        meetingtime: {
                                            validators: {
                                                notEmpty: {
                                                    message: '会议时间！'
                                                },
                                            }
                                        },
                                        place: {
                                            validators: {
                                                notEmpty: {
                                                    message: '会议地点不能为空！'
                                                },
                                            }
                                        },
                                        attendees: {
                                            validators: {
                                                notEmpty: {
                                                    message: '出席人员不能为空！'
                                                },
                                            }
                                        },
                                        host: {
                                            validators: {
                                                notEmpty: {
                                                    message: '主持人不能为空！'
                                                },
                                            }
                                        },
                                        meetingcontent: {
                                            validators: {
                                                notEmpty: {
                                                    message: '会议内容不能为空！'
                                                },
                                            }
                                        },
                                        endtime: {
                                            validators: {
                                                notEmpty: {
                                                    message: '结束时间不能为空！'
                                                },
                                            }
                                        },
                                    }
                                });
                                var bootstrapValidator = $("#myform").data('bootstrapValidator');
                                bootstrapValidator.validate();
                                if (bootstrapValidator.isValid()) {
                                    $.post("${ctx}/meetingrecord/updateMeetingrecord", json).done(function (data) {
                                        getCode(data);
                                    }).fail(function (data) {
                                        getCode(data)
                                    });
                                }
                            }
                        }, {
                            label: '关闭',
                            icon: 'fa fa-close',
                            action: function (dialogItself) {
                                dialogItself.close();
                            }
                        }]
                    });
                },
                //删除操作    url  服务器路径
                deleteRow: function (row) {
                    myConfirm("${ctx}/meetingrecord/daleteMeetingrecord", row);
                }
            }
        });
    });
</script>
<script type="text/javascript">
    var os1 = new Optiscroll(document.getElementById('os1'), { maxTrackSize: 80, preventParentScroll: true });
</script>
</body>
</html>
