<%@ page contentType="text/html;charset=UTF-8" language="java" %>
<%@ taglib prefix="c" uri="http://java.sun.com/jsp/jstl/core" %>
<c:set var="ctx" value="${pageContext.request.contextPath}"/>
<c:set var="motherid" value="${pageContext.request.getParameter('motherid')}" />
<c:set var="motherType" value="${pageContext.request.getParameter('motherType')}" />
<html>
<head>
    <title>妈妈生命体征</title>
</head>

<body>
<!--Main Content-->
<div class="page-wrapper">
    <div class="container-fluid">
        <!-- Row-->
        <div class="row">
            <div class="col-sm-12">
                <ul id="myTab" class="nav nav-tabs" style="margin-top: 10px">
                    <li id="motherEvaluate"><a href="${ctx}/servicecenter/motherEvaluate?motherid=${motherid}&motherType=${motherType}">妈妈入住评估表</a></li>
                    <li id="patientrounds"><a href="${ctx}/servicecenter/patientrounds?motherid=${motherid}&motherType=${motherType}">妈妈医生查房记录</a></li>
                    <li id="mothernursingrecorddetail"><a href="${ctx}/servicecenter/mothernursingrecorddetail?motherid=${motherid}&motherType=${motherType}">妈妈护理记录</a></li>
                    <li id="nursingEducation"><a href="${ctx}/servicecenter/nursingEducation?motherid=${motherid}&motherType=${motherType}">妈妈卫教登记表</a></li>
                    <li id="motherquestion"><a href="${ctx}/servicecenter/motherquestion?motherid=${motherid}&motherType=${motherType}">妈妈产后忧虑量表</a></li>
                    <li id="VitalSign"><a href="${ctx}/servicecenter/VitalSign?motherid=${motherid}&motherType=${motherType}">妈妈生命体征登记</a></li>
                    <div id="babyInfo" style="margin-left: 60%;display: none;">
                        <input type="button" id="type1" class='btn block btn-outline btn-rounded btn-primary' onclick="findbaby()" value="宝宝信息" >
                    </div>
                </ul>
                <!--妈妈生命体征-->
                <div class="panel-body">
                    <div class="table-responsive">
                        <table id="motherrounds" class="table" data-paging="true" data-filtering="true" data-sorting="true">
                        </table>
                    </div>
                </div>
                <!--妈妈生命体征-->
            </div>
        </div>
        <!-- /Row -->
    </div>
</div>
<script>
    $(function () {
        (function ($) {
            $.getUrlParam = function (name) {
                var reg = new RegExp("(^|&)" + name + "=([^&]*)(&|$)");
                var r = window.location.search.substr(1).match(reg);
                if (r != null) return unescape(r[2]); return null;
            }
        })(jQuery);
        var motherType = $.getUrlParam('motherType');
        if(motherType==1){
            $("#babyInfo").css("display","block");
        }
        $('#VitalSign').addClass("active");
        var ur=location.href;
        var type=ur.split('/')[4].split("?")[0];
        switch (type){
            case 'mothernursingrecorddetail':
                $('#mothernursingrecorddetail').addClass("active");
                break;
            case 'patientrounds':
                $('#patientrounds').addClass("active");
                break;
            case 'nursingEducation':
                $('#nursingEducation').addClass("active");
                break;
            case 'motherquestion':
                $('#motherquestion').addClass("active");
                break;
            case 'motherEvaluate':
                $('#motherEvaluate').addClass("active");
                break;
            case 'VitalSign':
                $('#VitalSign').addClass("active");
                break;
        }
        var VitalSign = [
            {
                "name": "id",
                "title": "ID",
                "breakpoints": "xs sm",
                visible:false
            },
            {"name":"measureTime","title":"时间"},
            {"name":"p","title":"p"},
            {"name":"t","title":"t"},
            {"name":"bp","title":"bp"},
            {"name":"r","title":"r"},
            {"name":"motherid","title":"妈妈id", visible:false},

        ];
        function findbaby(id) {
            window.location.href='${ctx}/servicecenter/babybasic?motherid=${motherid}';
        }
        window.findbaby = findbaby;


        //启动footable
        var ft = FooTable.init('#motherrounds',{
            "columns": VitalSign,
            "rows": $.get("${ctx}/VitalSign/getVitalSign?motherid="+'${motherid}'),
            //功能操作
            editing: {
                enabled: true,
                addRow: function(){
                    //新增模态框
                    var $that = $(this);
                    var dialog =  BootstrapDialog.show({
                        type : BootstrapDialog.TYPE_DEFAULT,
                        title : "<span style=\"color: #ab8ce4\"><i></i>新增一条数据</span>",
                        closable: false,
                        draggable: true,
                        cssClass: 'api-blacklist-form-add',
                        message:$('<div></div>').load('${ctx}/template/servicecenter/VitalSign.jsp'),//加载弹出页面
                        size : BootstrapDialog.SIZE_WIDE,//弹出框大
                        onhide:function(){
                            $that.removeAttr("disabled");
                        },
                        buttons:[{
                            id: 'btn-form-submit',
                            label: '提交',
                            icon: 'fa fa-check-circle',
                            cssClass: 'btn-primary',
                            action:function(){//点击事件
                                var json = {
                                    bp:$('#bp').val(),
                                    p: $('#p').val(),
                                    t: $('#t').val(),
                                    r: $('#r').val(),
                                    measureTime: $('#measureTime').val(),
                                    motherid:'${motherid}',
                                    storeId:'<%=session.getAttribute("storeId")%>'
                                };
                                $("#myform").bootstrapValidator({
                                    live: 'disabled',//验证时机，enabled是内容有变化就验证（默认），disabled和submitted是提交再验证
                                    excluded: [':disabled', ':hidden', ':not(:visible)'],//排除无需验证的控件，比如被禁用的或者被隐藏的
                                    submitButtons: '#btn-test',//指定提交按钮，如果验证失败则变成disabled，但我没试成功，反而加了这句话非submit按钮也会提交到action指定页面
                                    message: '通用的验证失败消息',//好像从来没出现过
                                    feedbackIcons: {//根据验证结果显示的各种图标
                                        valid: 'glyphicon glyphicon-ok',
                                        invalid: 'glyphicon glyphicon-remove',
                                        validating: 'glyphicon glyphicon-refresh'
                                    },
                                    fields:{ //需要验证的字段
                                        measureTime:{
                                            validators: {
                                                notEmpty: {
                                                    message: '时间不能为空！'
                                                },
                                            }
                                        },
                                    }
                                });
                                var bootstrapValidator = $("#myform").data('bootstrapValidator');
                                bootstrapValidator.validate();
                                if(bootstrapValidator.isValid()) { //新增
                                    $.post("${ctx}/VitalSign/addVitalSign",json).done(function(data){getCode(data)}).fail(function(data){getCode(data)});
                                }
                            }
                        },{
                            label:'关闭',
                            icon:'fa fa-close',
                            action:function(dialogItself) {
                                dialogItself.close();
                            }
                        }]
                    });
                },
                //这里是修改时绑定数据
                editRow: function(row){
                    var values = row.val();
                    var $that = $(this);
                    //失效
                    $that.attr("disabled","disabled");
                    // 调用add方法
                    var dialog = BootstrapDialog.show({
                        type : BootstrapDialog.TYPE_DEFAULT,
                        title : "<span style=\"color: #ab8ce4\"><i></i>修改一条数据</span>",
                        closable: false,
                        draggable: true,
                        cssClass: 'api-blacklist-form-add',
                        message:$('<div></div>').load('${ctx}/template/servicecenter/VitalSign.jsp'),//加载弹出页面
                        size : BootstrapDialog.SIZE_WIDE,//弹出框大小。
                        //数据回显
                        onshown:function(dialogRef){
                            $('#id').val(values.id);
                            $('#r').val(values.r);
                            $('#p').val(values.p);
                            $('#bp').val(values.bp);
                            $('#t').val(values.t);
                            $('#measureTime').val(values.measureTime);
                        },
                        buttons:[{
                            id: 'btn-form-submit',
                            label: '提交',
                            icon: 'fa fa-check-circle',
                            cssClass: 'btn-primary',
                            action:function(){
                                var json = {
                                    id: $('#id').val(),
                                    bp:$('#bp').val(),
                                    p: $('#p').val(),
                                    t: $('#t').val(),
                                    r: $('#r').val(),
                                    measureTime: $('#measureTime').val(),
                                    motherid:'${motherid}',
                                    storeId:'<%=session.getAttribute("storeId")%>'
                                };
                                $("#myform").bootstrapValidator({
                                    live: 'disabled',//验证时机，enabled是内容有变化就验证（默认），disabled和submitted是提交再验证
                                    excluded: [':disabled', ':hidden', ':not(:visible)'],//排除无需验证的控件，比如被禁用的或者被隐藏的
                                    submitButtons: '#btn-test',//指定提交按钮，如果验证失败则变成disabled，但我没试成功，反而加了这句话非submit按钮也会提交到action指定页面
                                    message: '通用的验证失败消息',//好像从来没出现过
                                    feedbackIcons: {//根据验证结果显示的各种图标
                                        valid: 'glyphicon glyphicon-ok',
                                        invalid: 'glyphicon glyphicon-remove',
                                        validating: 'glyphicon glyphicon-refresh'
                                    },
                                    fields: {
                                        customername:{
                                            validators: {
                                                notEmpty: {
                                                    message: '妈妈姓名不能为空！'
                                                },
                                            }
                                        },

                                        shrinkage:{
                                            validators: {
                                                notEmpty: {
                                                    message: '子宫收缩情况不能为空！'
                                                },
                                            }
                                        },

                                        cesareansection:{
                                            validators: {
                                                notEmpty: {
                                                    message: '剖腹产术后刀口不能为空！'
                                                },
                                            }
                                        },

                                        sidecutter:{
                                            validators: {
                                                notEmpty: {
                                                    message: '侧切刀情况不能为空！'
                                                },
                                            }
                                        },

                                        lochiacolor:{
                                            validators: {
                                                notEmpty: {
                                                    message: '恶露颜色不能为空！'
                                                },
                                            }
                                        },
                                        lochiasmell:{
                                            validators: {
                                                notEmpty: {
                                                    message: '恶露气味不能为空！'
                                                },
                                            }
                                        },
                                        fever:{
                                            validators: {
                                                notEmpty: {
                                                    message: '有无发热不能为空！'
                                                },
                                            }
                                        },
                                        othersituations:{
                                            validators: {
                                                notEmpty: {
                                                    message: '其他情况不能为空！'
                                                },
                                            }
                                        },
                                    },
                                });
                                var bootstrapValidator = $("#myform").data('bootstrapValidator');
                                bootstrapValidator.validate();
                                if(bootstrapValidator.isValid()){
                                    $.post("${ctx}/VitalSign/updateVitalSign",json).done(function(data){
                                        getCode(data)}).fail(function(data){
                                        getCode(data)});
                                    setTimeout("window.location.reload();",1000);
                                }
                            }
                        },{
                            label : '关闭',
                            icon: 'fa fa-close',
                            action : function(dialogItself) {
                                dialogItself.close();
                            }
                        }],
                    });
                },
                //删除操作
                deleteRow: function(row){
                    myConfirm("${ctx}/VitalSign/deleteVitalSign",row);
                }
            }
        });
    });
</script>
</body>
</html>
